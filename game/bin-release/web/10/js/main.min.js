var AssetAdapter=function(){function e(){}var t=(__define,e),i=t.prototype;return i.getAsset=function(e,t,i){function s(s){t.call(i,s,e)}if(RES.hasRes(e)){var r=RES.getRes(e);r?s(r):RES.getResAsync(e,s,this)}else RES.getResByUrl(e,s,this,RES.ResourceItem.TYPE_IMAGE)},e}();egret.registerClass(AssetAdapter,"AssetAdapter",["eui.IAssetAdapter"]);var ThemeAdapter=function(){function e(){}var t=(__define,e),i=t.prototype;return i.getTheme=function(e,t,i,s){function r(e){t.call(s,e)}function n(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,n,null),i.call(s))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,n,null),RES.getResByUrl(e,r,this,RES.ResourceItem.TYPE_TEXT)},e}();egret.registerClass(ThemeAdapter,"ThemeAdapter",["eui.IThemeAdapter"]);var Airplane=function(e){function t(){e.call(this),this.bloodNum=1,this.speed=5,this.airName="air",this.airBulletName="1",this.bulletTexture=ImageHandle.getTexture("img_bullet_png",953,640,50,50)}__extends(t,e);var i=(__define,t),s=i.prototype;return s.setImg=function(e){this.bmp&&this.removeChild(this.bmp),this.bmp=e,this.addChild(this.bmp)},s.setFireDelay=function(e){this.fireTimer=new egret.Timer(e),this.fireTimer.addEventListener(egret.TimerEvent.TIMER,this.createBullet,this)},s.fire=function(){this.fireTimer&&this.fireTimer.start()},s.stopFire=function(){this.fireTimer&&this.fireTimer.stop()},s.createBullet=function(e){this.dispatchEventWith("createBullet",!1)},s.getScore=function(){return 1.5*this.bloodNum},s.getBulletTexture=function(){return this.bulletTexture},s.getBulletName=function(){return this.airBulletName},s.getBullet=function(){return new Bullet(this.getBulletTexture())},t}(egret.DisplayObjectContainer);egret.registerClass(Airplane,"Airplane");var AirplaneOver=function(e){function t(){e.call(this),this.endImg=[RES.getRes("wsparticle_01_png"),RES.getRes("wsparticle_06_png"),RES.getRes("wsparticle_07_png")],this.endTime=new egret.Timer(100),this.endTime.addEventListener(egret.TimerEvent.TIMER,this.animat,this)}__extends(t,e);var i=(__define,t),s=i.prototype;return t.produce=function(){var e,i=t.cacheDict;return e=i.length>0?i.pop():new t},t.reclaim=function(e){var i=t.cacheDict;-1==i.indexOf(e)&&i.push(e)},s.open=function(e,t){this.fun=t,this.animatIndex=0,this.texture=this.endImg[this.animatIndex],this.visible=!0,this.x=e.x+e.width/2-this.width/2,this.y=e.y+e.height/2-this.height/2,this.endTime.start()},s.animat=function(){var e=this.animatIndex+1;this.animatIndex=e==this.endImg.length?0:e,0==this.animatIndex?(this.endTime.stop(),this.visible=!1,this.fun&&(this.fun(),this.fun=null)):this.texture=this.endImg[this.animatIndex]},t.cacheDict=[],t}(egret.Bitmap);egret.registerClass(AirplaneOver,"AirplaneOver");var BgMap=function(e){function t(){e.call(this),this.speed=2,this.level=1,this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(t,e);var i=(__define,t),s=i.prototype;return s.onAddToStage=function(e){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.init()},s.init=function(){this.stageW=this.stage.stageWidth,this.stageH=this.stage.stageHeight;var e=RES.getRes("img_bg_level_"+this.level);this.textureHeight=e.textureHeight,this.rowCount=Math.ceil(this.stageH/this.textureHeight)+1,this.bmpArr=[];for(var t=0;t<this.rowCount;t++){var i=new egret.Bitmap(e);i.y=this.textureHeight*t-(this.textureHeight*this.rowCount-this.stageH),this.bmpArr.push(i),this.addChild(i)}},s.start=function(){this.removeEventListener(egret.Event.ENTER_FRAME,this.enterFrameHandler,this),this.addEventListener(egret.Event.ENTER_FRAME,this.enterFrameHandler,this)},s.enterFrameHandler=function(e){for(var t=0;t<this.rowCount;t++){var i=this.bmpArr[t];i.y+=this.speed,i.y>this.stageH&&(i.y=this.bmpArr[0].y-this.textureHeight,this.bmpArr.pop(),this.bmpArr.unshift(i))}},s.pause=function(){this.removeEventListener(egret.Event.ENTER_FRAME,this.enterFrameHandler,this)},t}(egret.DisplayObjectContainer);egret.registerClass(BgMap,"BgMap");var Blood=function(e){function t(){e.call(this),this.shp=new egret.Shape,this.addChild(this.shp),this.x=5,this.y=30}__extends(t,e);var i=(__define,t),s=i.prototype;return s.setBlood=function(e){this.shp.graphics.clear(),this.shp.graphics.beginFill(16711680),this.shp.graphics.drawRect(0,0,10*e,10),this.shp.graphics.endFill()},t}(egret.DisplayObjectContainer);egret.registerClass(Blood,"Blood");var BossAirplane=function(e){function t(){e.call(this),this.bloodNum=200,this.fireDelay=1300,this.bulletTexture=ImageHandle.getTexture("img_bullet_png",780,693,55,55),this.texture=ImageHandle.getTexture("img_plane_boss_png",0,370,548,280),this.speed=1;var t=new egret.Bitmap(this.texture);t.width=t.width/2,t.height=t.height/2,this.blood=this.bloodNum,this.setImg(t),this.setFireDelay(this.fireDelay)}__extends(t,e);var i=(__define,t),s=i.prototype;return s.getBulletTexture=function(){return this.bulletTexture},s.getBulletName=function(){return"boss"},s.setXY=function(e,t){this.x=e-this.width/2,this.y=t-this.height/2},s.getBullet=function(){var e=new Bullet(this.getBulletTexture());return e.width=e.width/1.5,e.height=e.height/1.5,e.speed=2.5,e.power=1,e.direction="down",e},s.addBlood=function(){this.blood=this.bloodNum},s.getScore=function(){return 1.5*this.bloodNum},s.getBulletStartX=function(e){return this.x+this.width/2-e.width/2},s.getBulletStartY=function(e){return this.y+e.height},t}(Airplane);egret.registerClass(BossAirplane,"BossAirplane");var Bullet=function(e){function t(t){e.call(this,t),this.speed=10,this.power=1,this.direction="up",this.position=0,this.positionNum=1}__extends(t,e);var i=(__define,t);i.prototype;return t.produce=function(e){var i=e.getBulletName();null==t.cacheDict[i]&&(t.cacheDict[i]=[]);var s,r=t.cacheDict[i];return s=r.length>0?r.pop():e.getBullet(),s.name=i,s},t.reclaim=function(e){null==t.cacheDict[e.name]&&(t.cacheDict[e.name]=[]);var i=t.cacheDict[e.name];-1==i.indexOf(e)&&i.push(e)},t.cacheDict={},t}(egret.Bitmap);egret.registerClass(Bullet,"Bullet");var Button=function(e){function t(t,i){e.call(this),this.bmp=new egret.Bitmap(t),this.bmp.width*=.5,this.bmp.height*=.5,this.addChild(this.bmp),this.label=new egret.TextField,this.label.text=i,this.addChild(this.label),this.label.size=24,this.label.width=this.bmp.width,this.label.height=this.bmp.height,this.label.textAlign=egret.HorizontalAlign.CENTER,this.label.verticalAlign=egret.VerticalAlign.MIDDLE,this.label.y=-5,this.touchEnabled=!0}__extends(t,e);var i=(__define,t),s=i.prototype;return s.click=function(e,t){this.addEventListener(egret.TouchEvent.TOUCH_TAP,e,t)},t}(egret.DisplayObjectContainer);egret.registerClass(Button,"Button");var EnemyAirplane=function(e){function t(t){e.call(this),this.enemyMap={1:{texture:ImageHandle.getTexture("img_plane_enemy_png",265,474,100,78),fireDelay:0,bulletTexture:"",bulletSpeed:0,bulletPower:0,speed:5,blood:2},2:{texture:ImageHandle.getTexture("img_plane_enemy_png",161,476,106,74),fireDelay:0,bulletTexture:"",bulletSpeed:0,bulletPower:0,speed:4,blood:4},3:{texture:ImageHandle.getTexture("img_plane_enemy_png",0,230,190,134),fireDelay:1e3,bulletTexture:ImageHandle.getTexture("img_bullet_png",283,172,50,50),bulletSpeed:6,bulletPower:1,speed:2,blood:10},4:{texture:ImageHandle.getTexture("img_plane_enemy_png",186,338,182,138),fireDelay:700,bulletTexture:ImageHandle.getTexture("img_bullet_png",283,172,50,50),bulletSpeed:8,bulletPower:1,speed:1.5,blood:15}},this.planeName=t,this.speed=this.enemyMap[t].speed,this.blood=this.enemyMap[t].blood,this.setImg(new egret.Bitmap(this.enemyMap[t].texture)),this.enemyMap[t].fireDelay&&this.setFireDelay(this.enemyMap[t].fireDelay)}__extends(t,e);var i=(__define,t),s=i.prototype;return t.produce=function(e){null==t.cacheDict[e]&&(t.cacheDict[e]=[]);var i,s=t.cacheDict[e];return i=s.length>0?s.pop():new t(e),i.name=e,i},t.reclaim=function(e){null==t.cacheDict[e.name]&&(t.cacheDict[e.name]=[]);var i=t.cacheDict[e.name];-1==i.indexOf(e)&&i.push(e)},s.getBulletTexture=function(){return this.enemyMap[this.planeName].bulletTexture},s.getBulletName=function(){return"enemy"+this.planeName},s.setXY=function(e,t){this.x=e-this.width/2,this.y=t-this.height/2},s.getBullet=function(){var e=new Bullet(this.getBulletTexture());return e.speed=this.enemyMap[this.planeName].bulletSpeed,e.power=this.enemyMap[this.planeName].bulletPower,e.direction="down",e.width=e.width/1.5,e.height=e.height/1.5,e},s.addBlood=function(){this.blood=this.enemyMap[this.planeName].blood},s.getScore=function(){return this.enemyMap[this.planeName].blood},s.getBulletStartX=function(e){return this.x+this.width/2-e.width/2},s.getBulletStartY=function(e){return this.y+this.height-e.height},t.cacheDict={},t}(Airplane);egret.registerClass(EnemyAirplane,"EnemyAirplane");var GameContainer=function(e){function t(){e.call(this),this.enemyFighters=[],this.myBullets=[],this.enemyBullets=[],this.myScore=0,this._init=!1,this.level=0,this.isBoss=!1,this.bossF=!1,this.myBulletCoe=0,this.myBulletBlo=!0,this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(t,e);var i=(__define,t),s=i.prototype;return s.onAddToStage=function(e){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.createGameScene()},s.createGameScene=function(){this.stageW=this.stage.stageWidth,this.stageH=this.stage.stageHeight,this.bg=new BgMap,this.addChild(this.bg),this.btnStart=new Button(ImageHandle.getTexture("ui_new_common_png",3,120,300,100),"开始游戏"),this.btnStart.x=(this.stageW-this.btnStart.width)/2,this.btnStart.y=(this.stageH-this.btnStart.height)/2,this.btnStart.click(this.gameInit,this),this.addChild(this.btnStart),this.music=new Music,this.blood=new Blood},s.gameInit=function(){this.removeChild(this.btnStart),this._init||(this.myFighter=new MyAirplane,this.bhFighter1=new SmallAirplane,this.bhFighter2=new SmallAirplane(!0),this.bossFighter=new BossAirplane,this.enemyFightersTimer=new egret.Timer(1e3),this.enemyFightersTimer.addEventListener(egret.TimerEvent.TIMER,this.createEnemy,this),this.bossReadyTimer=new egret.Timer(3e4),this.bossReadyTimer.addEventListener(egret.TimerEvent.TIMER,this.boosReady,this),this.bossStartTimer=new egret.Timer(1e3),this.bossStartTimer.addEventListener(egret.TimerEvent.TIMER,this.boosStart,this),this.nextLable=new Next,this.myScoreShow=new egret.TextField,this.myScoreShow.text=String(this.myScore),this.addChild(this.myScoreShow),this.addChild(this.nextLable),this.addChild(this.blood),this._init=!0),this.myScore=0,this.myScoreShow.text=String(this.myScore),this.level=0,this.addBlood(),this.gameStart()},s.addBlood=function(){this.myFighter.addBlood(),this.blood.setBlood(this.myFighter.blood)},s.reduceBlood=function(e){this.music.bloodReduce(),this.myFighter.blood-=e,this.blood.setBlood(this.myFighter.blood)},s.enemyEnd=function(e){this.music.enemyOver(),this.myScore+=e.getScore(),this.myScoreShow.text=String(this.myScore),this.airplaneOver(e)},s.airplaneOver=function(e){var t=this,i=AirplaneOver.produce();this.addChild(i),i.open(e,function(){t.removeChild(i),AirplaneOver.reclaim(i)})},s.EndGame=function(){this.music.gameOver(),this.btnStart.label.text="重新开始",this.addChild(this.btnStart),this.gameStop()},s.gameStop=function(){this.bg.pause(),this.music.bgStop(),this.myFighter.stopFire(),this.bhFighter1.stopFire(),this.bhFighter2.stopFire(),this.bossFighter.stopFire(),this.removeEventListener(egret.Event.ENTER_FRAME,this.gameViewUpdate,this),this.myFighter.removeEventListener("createBullet",this.createMyBulletHandler,this),this.bhFighter1.removeEventListener("createBullet",this.createSmallBulletHandler,this),this.bhFighter2.removeEventListener("createBullet",this.createSmallBulletHandler,this),this.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchHandler,this),this.enemyFightersTimer.stop(),this.bossReadyTimer.stop(),this.gameClear()},s.gameClear=function(){this.removeChild(this.myFighter),this.airplaneOver(this.myFighter),this.removeChild(this.bhFighter1),this.removeChild(this.bhFighter2),this.isBoss&&(this.isBoss=!1,this.removeChild(this.bossFighter));for(var e=0;e<this.myBullets.length;e++)this.removeChild(this.myBullets[e]),Bullet.reclaim(this.myBullets[e]);this.myBullets=[];for(var e=0;e<this.enemyFighters.length;e++)this.enemyFighters[e].stopFire(),this.removeChild(this.enemyFighters[e]),EnemyAirplane.reclaim(this.enemyFighters[e]);this.enemyFighters=[];for(var e=0;e<this.enemyBullets.length;e++)this.removeChild(this.enemyBullets[e]),Bullet.reclaim(this.enemyBullets[e]);this.enemyBullets=[]},s.gameStart=function(){this.bg.start(),this.music.bgStart(),this.myFighter.y=this.stageH-this.myFighter.height-50,this.myFighter.x=(this.stageW-this.myFighter.width)/2,this.bhFighter1.setXY(this.myFighter),this.bhFighter2.setXY(this.myFighter),this.addChild(this.myFighter),this.addChild(this.bhFighter1),this.addChild(this.bhFighter2),this.addEventListener(egret.Event.ENTER_FRAME,this.gameViewUpdate,this),this.myFighter.addEventListener("createBullet",this.createMyBulletHandler,this),this.bhFighter1.addEventListener("createBullet",this.createSmallBulletHandler,this),this.bhFighter2.addEventListener("createBullet",this.createSmallBulletHandler,this),this.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchHandler,this),this.gameNextReady()},s.boosReady=function(){this.enemyFightersTimer.stop(),this.bossReadyTimer.stop(),this.bossStartTimer.start()},s.boosStart=function(){this.enemyFighters.length<=0&&(this.bg.pause(),this.isBoss=!0,this.addChild(this.bossFighter),this.bossFighter.x=this.stageW/2-this.bossFighter.width/2,this.bossFighter.y=-this.bossFighter.height,this.bossFighter.addBlood(),this.bossStartTimer.stop(),this.addChild(this.bossFighter),this.bossFighter.addEventListener("createBullet",this.createBoosBulletHandler,this),this.bossFighter.fire())},s.gameNextReady=function(){this.bg.start(),this.myFighter.stopFire(),this.bhFighter1.stopFire(),this.bhFighter2.stopFire(),this.level++,this.nextLable.setNumber(this.level),this.nextLable.x=(this.stageW-this.nextLable.width)/2,this.nextLable.y=(this.stageH-this.nextLable.height)/2,this.nextLable.ready(),this.nextLable.addEventListener("nextStart",this.gameNextStart,this)},s.gameNextStart=function(){this.nextLable.removeEventListener("nextStart",this.gameNextStart,this),this.myFighter.fire(),this.bhFighter1.fire(),this.bhFighter2.fire(),this.enemyFightersTimer.start(),this.bossReadyTimer.start()},s.createEnemy=function(){var e=Math.floor(4*Math.random()+1),t=EnemyAirplane.produce(String(e)),i=Math.random()*this.stageW;i>this.stageW-t.width&&(i-=t.width),t.x=i,t.y=-t.height-10*Math.random(),t.addEventListener("createBullet",this.createEnemyBulletHandler,this),t.addBlood(),t.fire(),this.addChild(t),this.enemyFighters.push(t)},s.gameViewUpdate=function(){var e=egret.getTimer(),t=1e3/(e-this._lastTime);this._lastTime=e;var i,s=60/t,r=0,n=this.myBullets.length,h=[];for(r=0;n>r;r++)i=this.myBullets[r],i.y-=i.speed*s,i.x+=i.position*s*Math.log(i.positionNum),i.positionNum++,i.y<-i.height&&h.push(i);for(r=0;r<h.length;r++)i=h[r],this.removeChild(i),Bullet.reclaim(i),this.myBullets.splice(this.myBullets.indexOf(i),1);h=[];var l,a=this.enemyFighters.length;for(r=0;a>r;r++)l=this.enemyFighters[r],l.y+=l.speed*s,l.y>this.stageH&&h.push(l);for(r=0;r<h.length;r++)l=h[r],this.removeChild(l),EnemyAirplane.reclaim(l),l.removeEventListener("createBullet",this.createEnemyBulletHandler,this),l.stopFire(),this.enemyFighters.splice(this.enemyFighters.indexOf(l),1);h=[];var o=this.enemyBullets.length;for(r=0;o>r;r++)i=this.enemyBullets[r],i.y+=i.speed*s,i.x+=i.position*i.positionNum*s,i.positionNum++,i.y>this.stageH&&h.push(i);for(r=0;r<h.length;r++)i=h[r],this.removeChild(i),Bullet.reclaim(i),this.enemyBullets.splice(this.enemyBullets.indexOf(i),1);h=[],this.isBoss&&(this.bossFighter.y<this.stageH/2-2*this.bossFighter.height&&(this.bossFighter.y+=this.bossFighter.speed*s),this.bossF&&this.bossFighter.x>0?this.bossFighter.x-=this.bossFighter.speed*s:(this.bossF=!1,this.bossFighter.x+=this.bossFighter.speed*s,this.bossFighter.x>this.stageW-this.bossFighter.width&&(this.bossF=!0))),this.gameHit()},s.createEnemyBulletHandler=function(e){var t;t=Bullet.produce(e.target),t.x=e.target.getBulletStartX(t),t.y=e.target.getBulletStartY(t),this.addChildAt(t,this.numChildren-1-this.enemyFighters.length),this.enemyBullets.push(t)},s.createSmallBulletHandler=function(e){var t;t=Bullet.produce(e.target),t.x=e.target.getBulletStartX(t),t.y=e.target.getBulletStartY(t),this.addChildAt(t,this.numChildren-1-this.enemyFighters.length),this.myBullets.push(t)},s.createMyBulletHandler=function(e){this.music.bullet(),this.myBulletBlo?this.myBulletCoe++:this.myBulletCoe--,0==this.myBulletCoe?this.myBulletBlo=!0:5==this.myBulletCoe&&(this.myBulletBlo=!1);var t=[];t.push(Bullet.produce(e.target)),t.push(Bullet.produce(e.target)),t.push(Bullet.produce(e.target)),t[0].position=.4*this.myBulletCoe,t[1].position=0,t[2].position=-.4*this.myBulletCoe;for(var i=0;i<t.length;i++)t[i].positionNum=1,t[i].x=e.target.getBulletStartX(t[i]),t[i].y=e.target.getBulletStartY(t[i]),this.addChildAt(t[i],this.numChildren-1-this.enemyFighters.length),this.myBullets.push(t[i])},s.createBoosBulletHandler=function(e){var t=[];t.push(Bullet.produce(e.target)),t.push(Bullet.produce(e.target)),t.push(Bullet.produce(e.target)),t.push(Bullet.produce(e.target)),t.push(Bullet.produce(e.target)),t[0].position=.03,t[1].position=.015,t[2].position=0,t[3].position=-.015,t[4].position=-.03;for(var i=0;i<t.length;i++)t[i].positionNum=1,t[i].x=e.target.getBulletStartX(t[i]),t[i].y=e.target.getBulletStartY(t[i]),this.addChildAt(t[i],this.numChildren-1-this.enemyFighters.length),this.enemyBullets.push(t[i])},s.touchHandler=function(e){if(e.type==egret.TouchEvent.TOUCH_MOVE){var t=e.stageX,i=e.stageY;this.myFighter.setXY(t,i),this.bhFighter1.setXY(this.myFighter),this.bhFighter2.setXY(this.myFighter)}},s.gameHit=function(){var e,t,i,s,r=this.myBullets.length,n=this.enemyFighters.length,h=this.enemyBullets.length,l=[],a=[];for(e=0;r>e;e++){for(i=this.myBullets[e],t=0;n>t;t++)s=this.enemyFighters[t],GameUtil.isHit(s,i)&&(s.blood-=i.power/this.level,-1==l.indexOf(i)&&l.push(i),s.blood<=0&&-1==a.indexOf(s)&&a.push(s));this.isBoss&&GameUtil.isHit(this.bossFighter,i)&&(this.bossFighter.blood-=i.power/this.level,-1==l.indexOf(i)&&l.push(i),this.bossFighter.blood<=0&&(this.enemyEnd(this.bossFighter),this.bossFighter.stopFire(),this.bossFighter.removeEventListener("createBullet",this.createBoosBulletHandler,this),this.removeChild(this.bossFighter),this.isBoss=!1,this.gameNextReady()))}for(e=0;h>e;e++)i=this.enemyBullets[e],GameUtil.isHit(this.myFighter,i)&&(this.reduceBlood(i.power),-1==l.indexOf(i)&&l.push(i));for(e=0;n>e;e++)s=this.enemyFighters[e],GameUtil.isHit(this.myFighter,s)&&(this.reduceBlood(10),-1==a.indexOf(s)&&a.push(s));if(this.myFighter.blood<=0)this.EndGame();else{for(;l.length>0;)i=l.pop(),this.removeChild(i),"up"==i.direction?this.myBullets.splice(this.myBullets.indexOf(i),1):this.enemyBullets.splice(this.enemyBullets.indexOf(i),1),Bullet.reclaim(i);for(;a.length>0;)s=a.pop(),s.stopFire(),s.removeEventListener("createBullet",this.createEnemyBulletHandler,this),this.removeChild(s),this.enemyFighters.splice(this.enemyFighters.indexOf(s),1),EnemyAirplane.reclaim(s),this.enemyEnd(s)}},t}(egret.DisplayObjectContainer);egret.registerClass(GameContainer,"GameContainer");var GameUtil=function(){function e(){}var t=(__define,e);t.prototype;return e.isHit=function(e,t){var i,s;return i=t.x+t.width/2,s=t.y+t.height/2,e.hitTestPoint(i,s)},e}();egret.registerClass(GameUtil,"GameUtil");var Music=function(){function e(){this.bgMusic=RES.getRes("game_music_mp3"),this.gameOverMusic=RES.getRes("game_over_mp3"),this.enemyOverMusic=RES.getRes("enemy1_down_mp3"),this.bulletMusic=RES.getRes("bullet_mp3"),this.bloodReduceMusic=RES.getRes("enemy4_out_mp3")}var t=(__define,e),i=t.prototype;return i.bgStart=function(){this.bgMusicChannel||(this.bgMusicChannel=this.bgMusic.play(0,0))},i.bgStop=function(){this.bgMusicChannel&&(this.bgMusicChannel.stop(),this.bgMusicChannel=null)},i.gameOver=function(){this.gameOverMusic.play(0,1)},i.bullet=function(){this.bulletMusic.play(0,1)},i.enemyOver=function(){this.enemyOverMusic.play(0,1)},i.bloodReduce=function(){this.bloodReduceMusic.play(0,1)},e}();egret.registerClass(Music,"Music");var MyAirplane=function(e){function t(){e.call(this),this.bloodNum=10,this.fireDelay=100,this.bulletTexture=ImageHandle.getTexture("img_bullet_png",768,120,172,122),this.texture=ImageHandle.getTexture("img_plane_main_png",268,0,120,106),this.touchEnabled=!0,this.setImg(new egret.Bitmap(this.texture)),this.setFireDelay(this.fireDelay)}__extends(t,e);var i=(__define,t),s=i.prototype;return s.getBulletTexture=function(){return this.bulletTexture},s.getBulletName=function(){return"my"},s.setXY=function(e,t){this.x=e-this.width/2,this.y=t-this.height/2},s.getBullet=function(){var e=new Bullet(this.getBulletTexture());return e.width=e.width/1.5,e.height=e.height/1.5,e.speed=15,e.power=1,e.direction="up",e},s.addBlood=function(){this.blood=this.bloodNum},s.getBulletStartX=function(e){return this.x+this.width/2-e.width/2},s.getBulletStartY=function(e){return this.y-e.height},t}(Airplane);egret.registerClass(MyAirplane,"MyAirplane");var Next=function(e){function t(){e.call(this),this.numImg=[ImageHandle.getTexture("ui_new_common_png",197,487,70,90),ImageHandle.getTexture("ui_new_common_png",131,412,70,90),ImageHandle.getTexture("ui_new_common_png",66,412,70,90),ImageHandle.getTexture("ui_new_common_png",-2,411,70,90),ImageHandle.getTexture("ui_new_common_png",391,426,70,90),ImageHandle.getTexture("ui_new_common_png",263,402,70,90),ImageHandle.getTexture("ui_new_common_png",196,398,70,90),ImageHandle.getTexture("ui_new_common_png",131,324,70,90),ImageHandle.getTexture("ui_new_common_png",65,324,70,90),ImageHandle.getTexture("ui_new_common_png",-1,324,70,90)],this.time=new egret.Timer(3e3),this.time.addEventListener(egret.TimerEvent.TIMER,this.start,this)}__extends(t,e);var i=(__define,t),s=i.prototype;return s.setNumber=function(e){var t=new egret.Bitmap(this.numImg[e]);this.addChild(t)},s.ready=function(){this.time.start()},s.start=function(){this.removeChildren(),this.time.stop(),this.dispatchEventWith("nextStart")},t}(egret.DisplayObjectContainer);egret.registerClass(Next,"Next");var SmallAirplane=function(e){function t(t){void 0===t&&(t=!1),e.call(this),this.isright=!1,this.fireDelay=500,this.bulletTexture=ImageHandle.getTexture("img_bullet_png",500,604,63,137),this.textureList=[ImageHandle.getTexture("img_pet_png",443,508,62,57),ImageHandle.getTexture("img_pet_png",169,209,62,57),ImageHandle.getTexture("img_pet_png",0,83,62,57),ImageHandle.getTexture("img_pet_png",224,262,62,57),ImageHandle.getTexture("img_pet_png",0,83,62,57),ImageHandle.getTexture("img_pet_png",169,209,62,57)],this.isright=t,this.setImg(new egret.Bitmap(this.textureList[0])),this.setFireDelay(this.fireDelay),this.animationIndex=0,this.animationTime=new egret.Timer(120),this.animationTime.addEventListener(egret.TimerEvent.TIMER,this.animation,this),this.animationTime.start()}__extends(t,e);var i=(__define,t),s=i.prototype;return s.animation=function(){var e=this.animationIndex+1;this.animationIndex=e==this.textureList.length?0:e,this.bmp.texture=this.textureList[this.animationIndex]},s.setXY=function(e){this.isright?this.x=e.x+e.width:this.x=e.x-this.width,this.y=e.y+30},s.getBulletTexture=function(){return this.bulletTexture},s.getBulletName=function(){return"small"},s.getBullet=function(){var e=new Bullet(this.getBulletTexture());return e.width=e.width/2,e.height=e.height/2,e.speed=10,e.power=1,e.direction="up",e},s.getBulletStartX=function(e){return this.x+this.width/2-e.width/2},s.getBulletStartY=function(e){return this.y-e.height},t}(Airplane);egret.registerClass(SmallAirplane,"SmallAirplane");var LoadingUI=function(e){function t(){e.call(this),this.createView()}__extends(t,e);var i=(__define,t),s=i.prototype;return s.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},s.setProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var Main=function(e){function t(){e.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(t,e);var i=(__define,t),s=i.prototype;return s.onAddToStage=function(e){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.init()},s.init=function(){this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},s.onConfigComplete=function(e){console.log("onConfigComplete"),RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},s.onResourceLoadComplete=function(e){console.log("onResourceLoadComplete"),"preload"==e.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.createGameScene())},s.onItemLoadError=function(e){console.warn("Url:"+e.resItem.url+" has failed to load")},s.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},s.onResourceProgress=function(e){"preload"==e.groupName&&this.loadingView.setProgress(e.itemsLoaded,e.itemsTotal)},s.createGameScene=function(){console.log("createGameScene");var e=new GameContainer;this.addChild(e)},t}(egret.DisplayObjectContainer);egret.registerClass(Main,"Main");var ImageHandle=function(){function e(){}var t=(__define,e);t.prototype;return e.getBitMap=function(e,t,i,s,r){return new egret.Bitmap(this.getTexture(e,t,i,s,r))},e.getTexture=function(e,t,i,s,r){var n=new egret.Rectangle(t,i,s,r),h=RES.getRes(e),l=new egret.RenderTexture;return l.drawToTexture(new egret.Bitmap(h),n),l},e}();egret.registerClass(ImageHandle,"ImageHandle");